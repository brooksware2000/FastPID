<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>FastPID: FastPID</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FastPID
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">FastPID </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A fast 32-bit fixed-point PID controller for avr-gcc.</p>
<p>This is a port of Mike Materas's <a href="https://github.com/mike-matera/FastPID">FastPID</a> project for Arduino.</p>
<h2>About</h2>
<p>This PID controller is faster than alternatives for Arduino because it avoids expensive floating point operations. The PID controller is configured with floating point coefficients and translates them to fixed point internally. This imposes limitations on the domain of the coefficients. Setting the I and D terms to zero makes the controller run faster. The controller is configured to run at a fixed frequency and calling code is responsible for running at that frequency. The <code>Ki</code> and <code>Kd</code> parameters are scaled by the frequency to save time during the <code>pid_step()</code> operation.</p>
<h2>Description of Coefficients</h2>
<ul>
<li><code>Kp</code> - P term of the PID controller.</li>
<li><code>Ki</code> - I term of the PID controller.</li>
<li><code>Kd</code> - D term of the PID controller.</li>
<li><code>Hz</code> - The execution frequency of the controller.</li>
</ul>
<h3>Coefficient Domain</h3>
<p>The computation pipeline expects 16 bit coefficients. This is controlled by <code>PARAM_BITS</code> and should not be changed or caluclations may overflow. The number of bits before and after the decimal place is controlled by <code>PARAM_SHIFT</code> in <code>FastPID.h</code>. The default value for <code>PARAM_SHIFT</code> is 8 and can be changed to suit your application.</p>
<ul>
<li><b>The parameter P domain is [0.00390625 to 255] inclusive.</b></li>
<li><b>The parameter I domain is P / Hz</b></li>
<li><b>The parameter D domain is P * Hz</b></li>
</ul>
<p>The controller checks for parameter domain violations and won't operate if a coefficient is outside of the range. All of the configuration operations return <code>bool</code> to alert the user of an error. The <code>pid_err()</code> function checks the error condition. Errors can be cleared with the <code>pid_clear()</code> function.</p>
<h2>Execution Frequency</h2>
<p><b>The execution frequency is not automatically detected as of version v1.1.0</b> This greatly improves the controller performance. Instead the <code>Ki</code> and <code>Kd</code> terms are scaled in the configuration step. It's essential to call <code>pid_step()</code> at the rate that you specify.</p>
<h2>Input and Output</h2>
<p>The input and the setpoint are an <code>int16_t</code> this matches the width of Analog pins and accomodate negative readings and setpoints. The output of the PID is an <code>int16_t</code>. The actual bit-width and signedness of the output can be configured.</p>
<ul>
<li><code>bits</code> - The output width will be limited to values inside of this bit range. Valid values are 1 through 16</li>
<li><code>sign</code> If <code>true</code> the output range is [-2^(bits-1), -2^(bits-1)-1]. If <code>false</code> output range is [0, 2^(bits-1)-1]. <b>The maximum output value of the controller is 32767 (even in 16 bit unsigned mode)</b></li>
</ul>
<h2>Performance</h2>
<p>FastPID performance varies depending on the coefficients. When a coefficient is zero less calculation is done. The controller was benchmarked using an Arduino UNO and the code below.</p>
<table class="doxtable">
<tr>
<th>Kp </th><th>Ki </th><th>Kd </th><th>Step Time (uS)  </th></tr>
<tr>
<td>0.1 </td><td>0.5 </td><td>0.1 </td><td>~64 </td></tr>
<tr>
<td>0.1 </td><td>0.5 </td><td>0 </td><td>~56 </td></tr>
<tr>
<td>0.1 </td><td>0 </td><td>0 </td><td>~28 </td></tr>
</table>
<p>For comparison the excellent <a href="https://github.com/br3ttb/Arduino-PID-Library">ArduinoPID</a> library takes an average of about 90-100 uS per step with all non-zero coefficients.</p>
<h2>API</h2>
<p>See the separate <a href="http://oddbit.com/FastPID/">API documentation</a> for API details.</p>
<h2>Tests &amp; Examples</h2>
<p><b>NB</b>: The examples have not yet been ported over to work with avr-gcc.</p>
<p>There are some simple unit tests in the <code>test/</code> directory; you can run them like this: </p><pre class="fragment">make -C test
</pre><p>The expected output will be something like: </p><pre class="fragment">make: Entering directory '/home/lars/src/FastPID/test'
test_pid_set_limits.ok
test_pid_clear.ok
test_pid_set_output.ok
test_pid_step.ok
test_pid_new.ok
All tests passed.
make: Leaving directory '/home/lars/src/FastPID/test'
</pre><p>The tests are defined in files named <code>test_&lt;something&gt;.c</code>. The other files in the <code>test/</code> directory are from the upstream Arduino project and will not be useful with this code. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
